<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Tail Monitor</title>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <link href="style.css" rel="stylesheet">

        <script src="analytics.js"></script>
    </head>

    <body class="hero-unit">
        <header>
          <h1 class="">Tail Monitor <small>Log file monitor like tail command.</small></h1>
        </header>

        <article>
            <section>
              <h3>
                <form class="form-inline">
                  <div class="form-group">
                    <input id="hiddenButton" type="file" style="display:none" onchange="changeHandler(event)"/>
                    <div class="input-group">
                       <input id="photoCover" class="form-control" type="text" readonly placeholder="Select a text file...">
                       <span class="input-group-btn">
                         <a class="btn btn-info" onclick="$id('hiddenButton').click();">Browse</a>
                       </span>
                    </div>
                  </div>
                </form>
              </h3>  
              <textarea id="ta" rows=21 readonly></textarea>
            </section>
        </article>
        <footer>
            Copyright Â© 2015 <a href="http://twitter.com/gelegele" target="_blank">@gelegele</a> All Rights Reserved.
        </footer>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <script>
            var $id = function(id) { return document.getElementById(id); }

            var fileSize;

            function changeHandler(e) {
                var file = e.target.files[0];
                readFile(file);
            };
            
            function dispatchChangeEvent() {
                var changeEvent = document.createEvent("HTMLEvents");
                changeEvent.initEvent("change", true, false);
                $id("hiddenButton").dispatchEvent(changeEvent);
            }

            var readFile = function(file) {
                if (fileSize == file.size) {
                    //alert("Not modified");
                    return;
                }
                if (!fileSize) { // first time only
                    setInterval("dispatchChangeEvent()",1000);
                }
                fileSize = file.size;

                $id("photoCover").value = file.name;

                var reader = new FileReader();
                reader.onload = function(e) {
                    $id("ta").value = e.target.result;
                    $id("ta").scrollTop = $id("ta").scrollHeight; // Set scroll position bottom.
                };
                reader.readAsText(file);
            };
        </script>
    </body>
</html>
